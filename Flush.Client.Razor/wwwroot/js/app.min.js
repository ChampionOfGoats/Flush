"use strict";const generatePlayerCardV3=function(n){return`
<div class="mx-2 mt-2 mb-3 d-flex flex-row" id="${n.playerID}">
    <div class="player-icon" id="status-${n.playerID}" data-avatar="${n.avatarID}"></div>
    <div class="ml-3 player-name">${n.player}</div>
</div>`},labels=["0","Â½","1","2","3","5","8","13","21","40","100","?"],PHASE=Object.freeze({Created:0,Voting:1,Results:2,Finished:3}),createChart=function(n,t){return new Chart(n,{type:"doughnut",data:{datasets:[{data:t,backgroundColor:["#FFFF00","#FFAE42","#FFA500","#FF4500","#FF0000","#922B3E","#EE82EE","#324AB2","#0000FF","#0D98BA","#008000","#9ACD32",]}],labels:labels},options:{legend:{display:!1},responsive:!0,animation:{animateScale:!0,animateRotate:!0},plugins:{labels:[{render:function(n){return`${n.label} SP`},fontSize:16,fontStyle:"bold",fontColor:"#FFF"}]}}})},mapVotesToCountAndSetDisplay=function(n){var t=[0,0,0,0,0,0,0,0,0,0,0,0];return n.forEach(function(n){n.vote!==null&&(t[n.vote]+=1,$(`#status-${n.playerID}`).attr("data-vote",labels[n.vote]))}),t},logCaughtErr=function(n){console.error(n.toString())};$(document).ready(function(){var t=undefined,i=PHASE.Created,r=window.sessionStorage.getItem("spc_user_token");const n=(new signalR.HubConnectionBuilder).withUrl("/app/session",{accessTokenFactory:function(){return r}}).withAutomaticReconnect().build();n.serverTimeoutInMilliseconds=6e4;n.start().then(function(){n.onclose(function(){$("#disconnectedModalLong").modal({backdrop:"static",keyboard:!1})})}).catch(logCaughtErr);n.on("PlayerJoined",function(n){if($("#playerlist").has(`#${n.playerID}`).length==0){var t=generatePlayerCardV3(n);$("#playerlist").append(t)}else $(`#status-${n.playerID}`).removeClass("disconnected")});n.on("PlayerDisconnected",function(n){$(`#status-${n.playerID}`).addClass("disconnected")});n.on("PlayerPurged",function(n){$(`#${n.playerID}`).remove()});n.on("ReceiveGameStateFromJoinRoom",function(n){if(n.players.forEach(function(t){var r,u,i;if($("#playerlist").has(`#${t.playerID}`).length||(r=generatePlayerCardV3(t),$("#playerlist").append(r)),u=`#status-${t.playerID}`,i=$(u),t.isModerator&&!i.hasClass("moderator")&&i.addClass("moderator"),t.isObserver&&!i.hasClass("observer")&&i.addClass("observer"),t.vote!=null)switch(n.phase){case PHASE.Results:i.attr("data-vote",labels[t.vote]);i.addClass("display-vote");case PHASE.Voting:case PHASE.Created:i.addClass("voted")}}),n.phase===PHASE.Results&&i!=PHASE.Results){var r=document.getElementById("resultsChart").getContext("2d"),u=mapVotesToCountAndSetDisplay(n.players);t=createChart(r,u);$("#votes-card").html(n.players.filter(function(n){return n.vote!=null}).length);$("#min-card").html(labels[n.low]);$("#max-card").html(labels[n.high]);$("#mode-card").html(labels[n.mode]);$("#results-tab").click()}i=n.phase;document.getElementById("leaveRoomButton").disabled=!1;$("#loginModal").modal("hide");$("#loader-complete").remove()});n.on("ReceiveVote",function(n){var t=`#status-${n.playerID}`;$(t).addClass("voted")});n.on("Transition",function(n){if(n.type==0){i=PHASE.Results;var r=mapVotesToCountAndSetDisplay(n.votes),u=document.getElementById("resultsChart").getContext("2d");t===undefined?t=createChart(u,r):(t.data.datasets[0].data=r,t.update());$(".player-icon[data-vote]").addClass("display-vote");$("#votes-card").html(n.votes.length);$("#min-card").html(labels[n.low]);$("#max-card").html(labels[n.high]);$("#mode-card").html(labels[n.mode]);$("#results-tab").click()}else transitionRespone.type==1?(i=PHASE.Voting,$(".vote").removeClass("active"),$(".vote").removeClass("focus"),$(".player-icon").removeClass("voted"),$(".player-icon").removeClass("display-vote"),$(".player-icon").attr("data-vote",null),$("#vote-tab").click()):console.error("unexpected transition code encountered.")});n.on("RoleChanged",function(n){var t=`#status-${n.playerID}`;n.isModerator?$(t).addClass("moderator"):$(t).removeClass("moderator")});$(".vote").click(function(n){n.preventDefault();$(".vote").removeClass("active");$(this).addClass("active");$.ajax({url:`${window.location.protocol}//${window.location.host}/api/v2/session/vote`,type:"POST",data:JSON.stringify({Vote:$(this).attr("data-value")}),dataType:"json",success:function(n){console.log(n)}})});$("#revealVote").click(function(n){n.preventDefault();$.ajax({url:`${window.location.protocol}//${window.location.host}/api/v2/session/transition`,type:"POST",data:JSON.stringify({Type:0}),dataType:"json",success:function(n){console.log(n)}})});$("#resetVote").click(function(n){n.preventDefault();$.ajax({url:`${window.location.protocol}//${window.location.host}/api/v2/session/transition`,type:"POST",data:JSON.stringify({Type:1}),dataType:"json",success:function(n){console.log(n)}})});$("#playerIsModerator").change(function(){event.preventDefault();this.checked?$("#playareamain").addClass("moderator"):$("#playareamain").removeClass("moderator");$.ajax({url:`${window.location.protocol}//${window.location.host}/api/v2/session/changerole`,type:"POST",data:JSON.stringify({IsModerator:this.checked}),dataType:"json",success:function(n){console.log(n)}})})});$(function(){$('[data-toggle="tooltip"]').tooltip({delay:{show:100,hide:100}})});$(document).ready(function(){const t=$("#messagelist"),n=(new signalR.HubConnectionBuilder).withUrl("/app/chathub",{accessTokenFactory:function(){return window.sessionStorage.getItem("spc_user_token")}}).withAutomaticReconnect().build();n.on("ReceiveMessage",function(n){const i=`<li>${n.message}</li>`;t.append(i)});$("#messaging").on("submit",function(n){n.preventDefault();const t=$("#myMessage");t.text().length>0&&$.post(`https://${window.location.hostname}/api/v2/chat`,{Message:t.text()},function(n){console.log(n)})});n.start().catch(console.error)});
//# sourceMappingURL=app.min.js.map